{{!< layout01}}

<script>

function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
            return pair[1];
        }
    }
    return (false);
}


$(function() {
    if (getQueryVariable('LID')) $('#teacher').val(getQueryVariable('LID'));
    if (getQueryVariable('BID')) $('#book').val(getQueryVariable('BID'));
})




function log_msg(msg,id) {
      var url="/log?msg="+msg+"&id="+id;
      $.get(url, function(data, status){
      });
    return true;
    }

function EnableFields() {

  var etype = $("#etype").val();
  switch (etype) {
    case 'INVENTORY':
      $("#teacher").val('INV');
      $("#divTeacher").fadeOut();
      $("#divClass").fadeOut();
      break;
    case 'ISSUE':
      $("#divTeacher").fadeIn();
      $("#divClass").fadeIn();
      break;
    case 2:
      break;
    case 3:
      break;
    case 4:
      break;
    case 5:
      break;
  }
}


function check_field(eID) {
  var name={};
  var check=false;
  switch (eID) {
    case 0:
      name='teacher';
      check=true;
      break;
    case 1:
      name='book';
      check=true;
      break;
    case 2:
      name='value';
      break;
    case 3:
      name='class';
      break;
    case 4:
      name='trantype';
      EnableFields();
      break;
    case 5:
      name='trantype';
      break;
  }
    log_msg(name,eID);
    if (check) {
      var val = $("#" + name).val();
      var url="/validate?eID="+eID+"&ID="+val;
      $.get(url, function(data, status){
        $("#inf_"+eID).text(data.value);
      });
    }

    var obj = $("#" + name + "_list").find("option[value='" + val + "']");
    if (eID>1 || obj != null && obj.length > 0 ) {
        return true;
      }
    else
        alert("Eingabe ungültig: "+val);
    $("#" + name).focus();
    return false;
}

function validateForm() {
  if (!check_field(0)) return false;
  if (!check_field(1)) return false;
//  if (!check_field(2)) return false;
  return true;
}

</script>
  <div id="infoi">
    <p ID=inf_title></p>
    <p ID=inf_0></p>
    <p ID=inf_1></p>
    <p ID=inf_2></p>
    <p ID=inf_3></p>
  </div>

  <div style="border-radius: 20px; background-color:lightgrey; padding-top:10px; padding-bottom:20px" class="container">
  <h1>{{title}}</h1>

  <div class="entry"} >
    <form id="ItemEditForm" name="ItemEditForm" class="form-horizontal" action="/transaction/create" onsubmit="return validateForm()" method="post" >
      <input  value="c" type="hidden"   name="mode_s" id="mode_s">

      <div class="form-group">
        <label class="control-label col-sm-2" for="type">Vorgang:</label>
          <div class="col-sm-6">
            <select onchange="check_field(4)" id=etype name=eType class="selectpicker col-sm-4" data-live-search="true" data-size="8" required>
              <optgroup label="Ausleihen">
                <option value="ISSUE" >Ausleien</option>
                <option value="RETURN" >Rückgabe</option>
              </optgroup>
              <optgroup label="Zu/Abgang">
                <option value="INVENTORY">Inventar</option>
                <option value="LOST">Verlust</option>
                <option value="NEW">Neu Beschaffung</option>
              </optgroup>
          </select>
        </div>
      </div>


      <div id="divTeacher" class="form-group">
        <label class="control-label col-sm-2" for="teacher">Lehrer:</label>
        <div class="col-sm-2">
          <input autofocus type="text"  class="form-control" name="teacher" id="teacher" list=teacher_list autocomplete="off" onchange="check_field(0)" placeholder="Names des Lehrers" required>
          <datalist id="teacher_list">
             {{#each teacher_list}}
                    <option value="{{this.ID}}" label="{{this.name}}  {{this.surename}}" />
             {{/each}}
          </datalist>
        </div>
        </div>


        <div class="form-group">
        <label class="control-label col-sm-2" for="book">Buch:</label>
        <div class="col-sm-2">
          <input  autofocus type="text" class="form-control" id="book" name="book" list=book_list autocomplete="off" onchange="check_field(1)" placeholder="Bitte Buch Titel eingeben" required>
          <datalist id="book_list">
             {{#each book_list}}
                    <option value="{{this.ID}}">{{this.name}} ({{this.ID}})</option>
             {{/each}}
          </datalist>
        </div>
      </div>

      <div id="divTime" class="form-group" style="display: none;" >
        <label class="control-label col-sm-2" for="time">Time:</label>
        <div class="col-sm-2">
          <input id="time" type="time" class="form-control"  >
          <script>
              document.getElementById("time").value = Date();
          </script>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-sm-2" for="type">Anzahl:</label>
          <div class="col-sm-1">
         <input id=value name=value type="text" pattern="[0-9]{1,3}" class="form-control" onchange="check_field(2)" placeholder="Anzahl" required>
        </div>
      </div>

      <div id="divClass" class="form-group">
        <label class="control-label col-sm-2" for="class">Klasse:</label>
        <div class="col-sm-2">
          <input  nchange="check_field(5)" autofocus type="text"  class="form-control" nchange="check_field(3)" name="class" id="class" autocomplete="off" placeholder="Klasse">
        </div>
        </div>



    <div class="form-group">
      <div class="col-sm-10">
          <button type="submit" class="btn btn-primary" >OK</button>
          <a href="{{cancel}}" id="cancel" name="cancel" class="btn btn-default">Cancel</a>
      </div>
    </div>

  </form>

  </div>
</div>
</div>
